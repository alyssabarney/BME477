---
title: "BME477 Project"
author: Alyssa Barney
---
Conditions Analysis

Purpose:
What features and analyses would the application provide?
This application allows a user to upload data (conditions.csv, procedures.csv, careplans.csv) and pick a condition to get information on. From the uploaded data, the user can see 4 analyses: 1) a table with every patient's information, listing each patient's patient id, condition(s), procedure(s), and careplan(s); 2) a table of the same information but only for patients with the selected condition; 3) a plot of the top 10 conditions that have the highest frequency of hospital visits; 4) a conclusion based on the selected condition.

Inputs:
  1) conditions.csv file
  2) procedures.csv file
  3) careplans.csv file
  4) Selected condition for analysis
Operation/Analyses:
  It will isolate columns from the uploaded data sets to just display patient id, conditions, procedures, and careplans. It will take the user's condition selection and isolate only patients with the condition and form conclusions on the that condition. Also the top 10 conditions with the highest frequency of patient visits will be isolated and displayed.

Output:
  Descriptive analysis:
  Selected Condition Conclusions tab
  Visualizations:
  All Patient Information tab, Patients with Selected Condition tab, and Top 10 Conditions tab 
  
```{r}
library(shiny)
library(data.table)
library(ggplot2)
library(dplyr)

#select condition box
a_list <- c('Acute allergic reaction', 'Acute bacterial sinusitis (disorder)', 'Acute bronchitis (disorder)', 'Acute viral pharyngitis (disorder)', 'Alzheimer\'s disease (disorder)', 'Anemia (disorder)', 'Antepartum eclampsia', 'Appendicitis', 'Atopic dermatitis', 'Atrial Fibrillation')
b_list <- c('Bleeding from anus', 'Blighted ovum', 'Body mass index 30+ - obesity (finding)', 'Body mass index 40+ - severely obese (finding)', 'Brain damage - traumatic', 'Bullet wound', 'Burn injury(morphologic abnormality)')
c_list <- c('Carcinoma in situ of prostate (disorder)', 'Cardiac Arrest', 'Child attention deficit disorder', 'Childhood asthma', 'Chronic congestive heart failure (disorder)', 'Chronic intractable migraine without aura', 'Chronic kidney disease stage 1 (disorder)', 'Chronic kidney disease stage 2 (disorder)', 'Chronic obstructive bronchitis (disorder)', 'Chronic pain', 'Chronic sinusitis (disorder)', 'Closed fracture of hip', 'Concussion injury of brain', 'Concussion with loss of consciousness', 'Concussion with no loss of consciousness', 'Contact dermatitis', 'Coronary Heart Disease', 'Cystitis')
d_list <- c('Diabetes', 'Diabetic renal disease (disorder)', 'Diabetic retinopathy associated with type II diabetes mellitus (disorder)', 'Drug overdose')
e_list <- c('Epilepsy', 'Escherichia coli urinary tract infection')
f_list <- c('Facial laceration', 'Familial Alzheimer\'s disease of early onset (disorder)', 'Fetus with unknown complication', 'First degree burn', 'Fracture of ankle', 'Fracture of clavicle', 'Fracture of forearm', 'Fracture of rib', 'Fracture of the vertebral column with spinal cord injury', 'Fracture of vertebral column without spinal cord injury', 'Fracture subluxation of wrist')
g_list <- c('Gout')
h_list <- c('History of appendectomy', 'History of cardiac arrest (situation)', 'History of myocardial infarction (situation)', 'History of single seizure (situation)', 'Hyperglycemia (disorder)', 'Hyperlipidemia', 'Hypertension', 'Hypertriglyceridemia (disorder)')
i_list <- c('Idiopathic atrophic hypothyroidism', 'Impacted molars', 'Injury of anterior cruciate ligament', 'Injury of medial collateral ligament of knee', 'Injury of tendon of the rotator cuff of shoulder')
l_list <- c('Laceration of foot', 'Laceration of forearm', 'Laceration of hand', 'Laceration of thigh', 'Localized  primary osteoarthritis of the hand', 'Macular edema and retinopathy due to type 2 diabetes mellitus (disorder)')
m_list <- c('Major depression  single episode', 'Major depression disorder', 'Malignant neoplasm of breast (disorder)', 'Malignant tumor of colon', 'Metabolic syndrome X (disorder)', 'Metastasis from malignant tumor of prostate (disorder)', 'Microalbuminuria due to type 2 diabetes mellitus (disorder)', 'Miscarriage in first trimester', 'Myocardial Infarction')
n_list <- c('Neoplasm of prostate', 'Neuropathy due to type 2 diabetes mellitus (disorder)', 'Non-small cell carcinoma of lung  TNM stage 1 (disorder)', 'Non-small cell lung cancer (disorder)', 'Nonproliferative diabetic retinopathy due to type 2 diabetes mellitus (disorder)', 'Normal pregnancy')
o_list <- c('Opioid abuse (disorder)', 'Osteoarthritis of hip', 'Osteoarthritis of knee', 'Osteoporosis (disorder)', 'Otitis media', 'Overlapping malignant neoplasm of colon')
p_list <- c('Pathological fracture due to osteoporosis (disorder)', 'Perennial allergic rhinitis', 'Perennial allergic rhinitis with seasonal variation', 'Pneumonia', 'Polyp of colon', 'Prediabetes', 'Preeclampsia', 'Primary fibromyalgia syndrome', 'Primary malignant neoplasm of colon', 'Primary small cell malignant neoplasm of lung  TNM stage 1 (disorder)', 'Proliferative diabetic retinopathy due to type II diabetes mellitus (disorder)', 'Protracted diarrhea', 'Pulmonary emphysema (disorder)', 'Pyelonephritis')
r_list <- c('Rupture of appendix', 'Rupture of patellar tendon')
s_list <- c('Seasonal allergic rhinitis', 'Second degree burn', 'Secondary malignant neoplasm of colon', 'Seizure disorder', 'Sinusitis (disorder)', 'Small cell carcinoma of lung (disorder)', 'Smokes tobacco daily', 'Sprain of ankle', 'Sprain of wrist', 'Streptococcal sore throat (disorder)', 'Stroke', 'Suspected lung cancer (situation)')
t_list <- c('Tear of meniscus of knee', 'Tubal pregnancy')
v_list <- c('Viral sinusitis (disorder)')
w_list <- c('Whiplash injury to neck')
abc_list <- c('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'L', 'M', 'N', 'O', 'P', 'R', 'S', 'T', 'V', 'W')

```

  
```{r}
ui <- fluidPage(
  
  #App title  
  titlePanel("Conditions Analysis"),
  
  #Sidebar layout with input & output definitions
  sidebarLayout(
    #Sidebar panel for inputs
    sidebarPanel(
      #text
      helpText("Upload files in the form \"conditions.csv\", \"procedures.csv\", and \"careplans.csv\". Choose a condition from list to get more information on."),
      
      #input: files
      fileInput(inputId = "file1", label = "Choose conditions CSV file", multiple = FALSE, accept = ".csv"), 
      fileInput(inputId = "file2", label = "Choose procedures CSV file", multiple = FALSE, accept = ".csv"), 
      fileInput(inputId = "file3", label = "Choose careplans CSV file", multiple = FALSE, accept = ".csv"), 
     
      #input: condition
      selectInput(inputId = "letter", label = "Pick the letter the condition starts with", choices = abc_list),
      conditionalPanel(
        condition = "input.letter == 'A'",
        selectInput(inputId = "conditiona", "Pick the condition", choices = a_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'B'",
        selectInput(inputId = "conditionb", "Pick the condition", choices = b_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'C'",
        selectInput(inputId = "conditionc", "Pick the condition", choices = c_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'D'",
        selectInput(inputId = "conditiond", "Pick the condition", choices = d_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'E'",
        selectInput(inputId = "conditione", "Pick the condition", choices = e_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'F'",
        selectInput(inputId = "conditionf", "Pick the condition", choices = f_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'G'",
        selectInput(inputId = "conditiong", "Pick the condition", choices = g_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'H'",
        selectInput(inputId = "conditionh", "Pick the condition", choices = h_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'I'",
        selectInput(inputId = "conditioni", "Pick the condition", choices = i_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'L'",
        selectInput(inputId = "conditionl", "Pick the condition", choices = l_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'M'",
        selectInput(inputId = "conditionm", "Pick the condition", choices = m_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'N'",
        selectInput(inputId = "conditionn", "Pick the condition", choices = n_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'O'",
        selectInput(inputId = "conditiono", "Pick the condition", choices = o_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'P'",
        selectInput(inputId = "conditionp", "Pick the condition", choices = p_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'R'",
        selectInput(inputId = "conditionr", "Pick the condition", choices = r_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'S'",
        selectInput(inputId = "conditions", "Pick the condition", choices = s_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'T'",
        selectInput(inputId = "conditiont", "Pick the condition", choices = t_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'V'",
        selectInput(inputId = "conditionv", "Pick the condition", choices = v_list)
      ),
      conditionalPanel(
        condition = "input.letter == 'W'",
        selectInput(inputId = "conditionw", "Pick the condition", choices = w_list)
      ),
      
      #action buttons
      #actionButton(inputId = "go", label = "Go"),
      
  ),
    
    #Main panel for displaying outputs
    mainPanel(
        #divide into tabs
        tabsetPanel(id = "tabset",
        tabPanel("All Patient Information",
          helpText("Click on Load Table after uploading all files."),
          actionButton("load", "Load Table"),
          tableOutput("table_all")),
        tabPanel("Patients with Selected Condition",
          helpText("You have selected:"),
          textOutput("select_choice"),
          helpText("Click Load Table to display all patients with the selected condition."),
          actionButton("load2", "Load Table"),
          tableOutput("table_cond")),
        tabPanel("Top 10 Conditions",
          helpText("Click Load Plot to display top 10 conditions with the highest frequency of hospital visits."),
          actionButton("load3", "Load Plot"),
          plotOutput("table_top")),
        tabPanel("Selected Condition Conclusions",
          helpText("You have selected:"),
          textOutput("conclusion"))
      )
  ))
)


server <- function(input, output, session) {
  options(shiny.maxRequestSize = 30*1024^2)
  conditions <- reactive({
    req(input$file1)
    read.csv(input$file1$datapath)
  })
  
  procedures <- reactive({
    req(input$file2)
    read.csv(input$file2$datapath)
  })
  
  careplans <- reactive({
    req(input$file3)
    read.csv(input$file3$datapath)
  })
 
  # output$select_choice <- reactive({
  #   paste("You chose", input$letter)
  # })
  make_merge2_df <- reactive({
    #isolate patient & description columns
      # cond$PATIENT <- conditions()$PATIENT
      # cond$DESCRIPTION <- conditions()$DESCRIPTION
      cond <- conditions() %>% select("PATIENT", "DESCRIPTION")
      #sort patient column
      cond_order <- cond[order(cond$PATIENT),]
      #isolate patient, description, reason columns
      # proc$PATIENT <- procedures()$PATIENT
      # proc$DESCRIPTION <- procedures()$DESCRIPTION
      #proc$REASONDESCRIPTION <- procedures()$REASONDESCRIPTION
      proc <- procedures() %>% select("PATIENT", "DESCRIPTION", "REASONDESCRIPTION")
      #sort patient column
      proc_order <- proc[order(proc$PATIENT),]
      #isolate columns
      # care$PATIENT <- careplans()$PATIENT
      # care$DESCRIPTION <- careplans()$DESCRIPTION
      #care$REASONDESCRIPTION <- careplans()$REASONDESCRIPTION
      care <- careplans() %>% select("PATIENT", "DESCRIPTION", "REASONDESCRIPTION")
      #sort patient column
      care_order <- care[order(care$PATIENT),]
      #find overlapping patients
      
      
      same_patient_list <- vector("list")
      same_patient <- duplicated(cond_order$PATIENT)
      for (i in 1:length(same_patient)){
        if (same_patient[i] == FALSE){
          new_element <- rep(cond_order$PATIENT[i])
          same_patient_list[[length(same_patient_list) + 1]] <- new_element
        }
      }
      #make a table with Patient, condition(s), procedure(s), & careplans
      
      #df$Patient <- same_patient_list
      
      cond_df <- aggregate(DESCRIPTION~PATIENT, cond_order, paste, collapse = ",")
      
      proc_df <- aggregate(DESCRIPTION~PATIENT, proc_order, paste, collapse = ",")
      
      care_df <- aggregate(DESCRIPTION~PATIENT, care_order, paste, collapse = ",")
      
      merge1_df <- merge(cond_df, proc_df, by = "PATIENT")
      merge2_df <- merge(merge1_df, care_df, by = "PATIENT")
      colnames(merge2_df) <- c('Patient', 'Condition', 'Procedure', 'Careplan')
      
      return(merge2_df)
  })
  observeEvent(input$load, {
    output$table_all <- renderTable({
      merge2_df <- make_merge2_df()
      merge2_df
    })
  })
  
  make_cond_list2_df <- reactive({
    #separate into each condition
      condition_each <- split(conditions(), conditions()$DESCRIPTION)
      
      #make a list of the number of each condition & the position of each condition
      freq_list <- vector("list")
      
      for (i in condition_each){
        new_element <- rep(nrow(i))
        freq_list[[length(freq_list) + 1]] <- new_element
      }
      
      freq_df <- data.frame(matrix(unlist(freq_list), nrow = length(freq_list), byrow = TRUE))
      
      freq_df$order <- c(1:nrow(freq_df))
      
      colnames(freq_df) <- c("freq", "order")
      
      #find the top recurring conditions
      #sort data in descending order & list top 10 freq & positions
      freq_df1 <- freq_df %>%
        arrange(desc(freq)) %>%
        slice(1:10)
      #isolate freq column
      freq_df2 <- freq_df1 %>%
        select("freq")
      colnames(freq_df2) <- c("Number of Visits")
      #take top 10 positions & convert it to list of conditions
      cond_list <- vector("list")
      for (i in 1:nrow(freq_df1)){
        j <- freq_df1$order[i]
        new_element <- rep(condition_each[j])
        cond_list[[length(cond_list) + 1]] <- new_element
      }
      
      #isolate just the condition names
      colnames <- c("Start", "Stop", "Patient", "Encounter", "Code", "Description")
      top1 <- as.data.frame(cond_list[[1]])
      names(top1) <- colnames
      top2 <- as.data.frame(cond_list[[2]])
      names(top2) <- colnames
      top3 <- as.data.frame(cond_list[[3]])
      names(top3) <- colnames
      top4 <- as.data.frame(cond_list[[4]])
      names(top4) <- colnames
      top5 <- as.data.frame(cond_list[[5]])
      names(top5) <- colnames
      top6 <- as.data.frame(cond_list[[6]])
      names(top6) <- colnames
      top7 <- as.data.frame(cond_list[[7]])
      names(top7) <- colnames
      top8 <- as.data.frame(cond_list[[8]])
      names(top8) <- colnames
      top9 <- as.data.frame(cond_list[[9]])
      names(top9) <- colnames
      top10 <- as.data.frame(cond_list[[10]])
      names(top10) <- colnames
      
      cond_list2 <- vector("list")
      cond_list2 <- c(top1$Description[1], top2$Description[1], top3$Description[1], top4$Description[1], top5$Description[1], top6$Description[1], top7$Description[1], top8$Description[1], top9$Description[1], top10$Description[1])
      
      #converting into df
      cond_list2_df <- as.data.frame(cond_list2)
      colnames(cond_list2_df) <- c("Conditions")
      
      cond_list2_df$Frequency <- freq_df2$`Number of Visits`
      
      return(cond_list2_df)
  })
  
  observeEvent(input$load3, {
    output$table_top <- renderPlot({
      cond_list2_df <- make_cond_list2_df()
      
      cond_list2_df_mod <- data.frame(lapply(cond_list2_df, rep, cond_list2_df$Frequency))
      
      ggplot(data.frame(cond_list2_df_mod), aes(x = cond_list2_df_mod$Conditions)) +
        geom_bar() + 
        scale_x_discrete(guide = guide_axis(n.dodge = 3)) + 
        labs(title = "Top 10 Conditions with the Highest Number of Hospital Visits") + 
        xlab("Conditions") + 
        ylab("Frequency of Hospital Visits")
    })
  })
    output$select_choice <- renderText({
      #read the selected condition
      if (input$letter == 'A'){
        paste0(input$conditiona)
      } else if (input$letter == 'B'){
        paste0(input$conditionb)
      } else if (input$letter == 'C'){
        paste0(input$conditionc)
      } else if (input$letter == 'D'){
        paste0(input$conditiond)
      } else if (input$letter == 'E'){
        paste0(input$conditione)
      } else if (input$letter == 'F'){
        paste0(input$conditionf)
      } else if (input$letter == 'G'){
        paste0(input$conditiong)
      } else if (input$letter == 'H'){
        paste0(input$conditionh)
      } else if (input$letter == 'I'){
        paste0(input$conditioni)
      } else if (input$letter == 'L'){
        paste0(input$conditionl)
      } else if (input$letter == 'M'){
        paste0(input$conditionm)
      } else if (input$letter == 'N'){
        paste0(input$conditionn)
      } else if (input$letter == 'O'){
        paste0(input$conditiono)
      } else if (input$letter == 'P'){
        paste0(input$conditionp)
      } else if (input$letter == 'R'){
        paste0(input$conditionr)
      } else if (input$letter == 'S'){
        paste0(input$conditions)
      } else if (input$letter == 'T'){
        paste0(input$conditiont)
      } else if (input$letter == 'V'){
        paste0(input$conditionv)
      } else if (input$letter == 'W'){
        paste0(input$conditionw)
      }
    })
    observeEvent(input$load2, {
      output$table_cond <- renderTable({
          merge2_df <- make_merge2_df()
          #make a table for the patients with the selected condition
          selected_df <- data.frame(matrix(ncol = 4))
          colnames(selected_df) <- c('Patient', 'Condition', 'Procedure', 'Careplan')
          if (input$letter == 'A'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditiona, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'B'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionb, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'C'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionc, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'D'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditiond, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'E'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditione, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'F'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionf, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'G'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditiong, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'H'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionh, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'I'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditioni, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'L'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionl, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'M'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionm, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'N'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionn, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'O'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditiono, patient_cond_list, fixed = TRUE) == TRUE){
                #selected_list[i] <- i
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'P'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionp, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'R'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionr, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'S'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditions, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'T'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditiont, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'V'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionv, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          } else if (input$letter == 'W'){
            for (i in 1:nrow(merge2_df)){
              patient_cond_list <- unlist(merge2_df$Condition[i])
              if (grepl(input$conditionw, patient_cond_list, fixed = TRUE) == TRUE){
                selected_df <- rbind(selected_df, merge2_df[i,])
              }
            }
          }
          selected_df
        })
  })
  
    output$conclusion <- renderText({
      cond_list2_df <- make_cond_list2_df()
      #determines if selected condition is in the top 10 conditions & will output conclusion based on that
      in_top10 <- FALSE
      if (input$letter == 'A'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditiona, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditiona, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditiona, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'B'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionb, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionb, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionb, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'C'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionc, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionc, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionc, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'D'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditiond, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditiond, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditiond, "  is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'E'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditione, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditione, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditione, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'F'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionf, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionf, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionf, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'G'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditiong, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditiong, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditiong, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'H'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionh, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionh, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionh, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'I'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditioni, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditioni, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditioni, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'L'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionl, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionl, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionl, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'M'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionm, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionm, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionm, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'N'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionn, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionn, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionn, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'O'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditiono, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditiono, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditiono, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'P'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionp, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionp, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionp, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'R'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionr, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionr, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionr, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'S'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditions, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditions, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditions, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'T'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditiont, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditiont, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditiont, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'V'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionv, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionv, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionv, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      } else if (input$letter == 'W'){
        for (i in 1:nrow(cond_list2_df)){
          if (grepl(input$conditionw, cond_list2_df$Conditions[i], fixed = TRUE) == TRUE){
            in_top10 <- TRUE
          }
        }
        if (in_top10 == TRUE){
        paste0(input$conditionw, " is in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should be prioritized. With a higher frequency patient visits, hospitals should allocate more resources or training towards the selected condition.")
      } else if (in_top10 == FALSE){
        paste0(input$conditionw, " is not in the top 10 conditions in terms of highest frequency of hospital visits. This suggests that this condition should not necessarily be prioritized over other conditions.")
      }
      }
    })
}

shinyApp(ui = ui, server = server)
```

